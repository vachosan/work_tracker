{% extends "tracker/base.html" %}
{% block title %}Test Mapy.cz API v7{% endblock %}
{% block content %}
<div class="container py-3">
  <h5>Test nové Mapy.cz API v7</h5>
  <p><strong>API klíč:</strong> {{ mapy_key }}</p>
  <p>Souřadnice: {{ latitude }}, {{ longitude }}</p>
  <div id="mapa" style="width:100%;height:400px;background:#eee;"></div>
</div>

<script>
  const mapyKey = "{{ mapy_key }}";
  const lat = parseFloat("{{ latitude }}".replace(",", "."));
  const lon = parseFloat("{{ longitude }}".replace(",", "."));

  // načteme loader bez klíče
  const script = document.createElement("script");
  script.src = "https://api.mapy.cz/js/api/v7/maploader.js";
  script.async = true;
  script.onload = async () => {
    try {
      // aktivujeme SDK s naším klíčem
      await mapycz.load(mapyKey);

      const map = await mapycz.Map.create(document.getElementById("mapa"), {
        center: { lat, lon },
        zoom: 13,
      });

      new mapycz.Marker({ lat, lon }).addTo(map);
      console.log("✅ Mapy.cz SDK v7 načteno");
    } catch (err) {
      console.error("❌ Chyba při inicializaci mapy:", err);
    }
  };
  script.onerror = () => console.error("❌ Nepodařilo se načíst loader Mapy.cz");
  document.head.appendChild(script);
</script>
{% endblock %}
